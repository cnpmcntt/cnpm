{% extends "base.html" %}

{% block content %}
<style>
    .sidebar-container {
        height: calc(100vh - 140px);
        display: flex;
        flex-direction: column;
        border-right: 1px solid #e0e0e0;
        background: #fff;
        border-radius: 12px 0 0 12px;
        overflow: hidden;
    }
    
    .sidebar-header {
        background: #f8f9fa;
        padding: 15px;
        font-weight: 700;
        border-bottom: 1px solid #e0e0e0;
        color: #333;
    }

    .lesson-list {
        overflow-y: auto;
        flex-grow: 1;
    }

    .lesson-item {
        padding: 12px 20px;
        cursor: pointer;
        border-bottom: 1px solid #f1f1f1;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        color: #555;
        text-decoration: none;
    }

    .lesson-item:hover {
        background-color: #f0f4f8;
        color: #000;
    }

    .lesson-item.active {
        background-color: #e3f2fd;
        color: #0d47a1;
        font-weight: 600;
        border-left: 4px solid #0d47a1;
    }

    .content-container {
        height: calc(100vh - 140px);
        overflow-y: auto;
        padding: 40px;
        background: #fff;
        border-radius: 0 12px 12px 0;
    }

    .lesson-content-pane {
        display: none;
        animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .placeholder-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: #888;
        text-align: center;
    }
</style>

<div class="container-fluid px-4">
    <div class="mb-3">
        <a href="/student" class="text-decoration-none text-muted fw-bold small">
            <i class="fas fa-arrow-left me-1"></i> Quay lại Dashboard
        </a>
    </div>

    <div class="row g-0 shadow-sm rounded-3 overflow-hidden border">
        <div class="col-md-3 sidebar-container">
            <div class="sidebar-header">
                <i class="fas fa-bars me-2 text-primary"></i> Nội Dung Khóa Học
            </div>
            
            <div class="lesson-list">
                <div class="bg-light p-2 small fw-bold text-uppercase text-muted ps-3 border-bottom">
                    Bài Giảng
                </div>
                
                {% for l in course.lessons %}
                <div class="lesson-item" onclick="openLesson('lesson-{{ l.lesson_id }}', this)">
                    <i class="far fa-play-circle me-3 text-primary"></i>
                    <span class="small">{{ l.title }}</span>
                </div>
                {% endfor %}

                <div class="bg-light p-2 small fw-bold text-uppercase text-muted ps-3 border-bottom mt-0">
                    Bài Tập & Kiểm Tra
                </div>

                {% for q in course.quizzes %}
                <a href="/student/quiz/take/{{ q.quiz_id }}" class="lesson-item">
                    <i class="fas fa-question-circle me-3 text-danger"></i>
                    <span class="small">{{ q.title }}</span>
                    <span class="badge bg-secondary ms-auto" style="font-size: 10px;">Quiz</span>
                </a>
                {% endfor %}

                {% for a in course.assignments %}
                <a href="/student/assignment/{{ a.assignment_id }}" class="lesson-item">
                    <i class="fas fa-pen-nib me-3 text-warning"></i>
                    <span class="small">{{ a.title }}</span>
                    <span class="badge bg-secondary ms-auto" style="font-size: 10px;">Tự luận</span>
                </a>
                {% endfor %}
            </div>
        </div>

        <div class="col-md-9 content-container">
            
            <div id="placeholder-view" class="placeholder-state">
                <img src="https://cdn-icons-png.flaticon.com/512/2921/2921222.png" width="100" class="mb-4 opacity-50">
                <h3 class="fw-bold text-dark">{{ course.title }}</h3>
                <p>Chọn bài học bên trái để bắt đầu.</p>
            </div>

            {% for l in course.lessons %}
            <div id="lesson-{{ l.lesson_id }}" class="lesson-content-pane">
                <h2 class="fw-bold text-dark mb-4 pb-2 border-bottom">{{ l.title }}</h2>
                
                <div class="fs-5 text-dark" style="line-height: 1.8;">
                    {{ l.content | safe }}
                </div>

                <div class="mt-5 pt-4 border-top text-end">
                    <button class="btn btn-success rounded-pill px-4 fw-bold">
                        <i class="fas fa-check me-2"></i> Hoàn thành bài học
                    </button>
                </div>
            </div>
            {% endfor %}

        </div>
    </div>
</div>

<script>
    function openLesson(lessonId, element) {
        document.getElementById('placeholder-view').style.display = 'none';

        const panes = document.querySelectorAll('.lesson-content-pane');
        panes.forEach(pane => pane.style.display = 'none');

        const target = document.getElementById(lessonId);
        if (target) {
            target.style.display = 'block';
        }

        const items = document.querySelectorAll('.lesson-item');
        items.forEach(item => item.classList.remove('active'));
        element.classList.add('active');
    }
</script>
{% endblock %}