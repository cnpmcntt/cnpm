{% extends "base.html" %}

{% block content %}
<style>
    .submission-card {
        background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 20px;
    }
    .score-box {
        background: #f8f9fa; border-radius: 6px; padding: 10px; text-align: center; border: 1px dashed #ccc;
    }
    .ai-badge { background-color: #e3f2fd; color: #0d47a1; font-size: 11px; padding: 3px 6px; border-radius: 4px; font-weight: bold; }
</style>

<div class="mb-3">
    <a href="/teacher" class="text-decoration-none text-muted fw-bold" style="font-size: 0.95rem;">
        <i class="fas fa-arrow-left me-2"></i> Quay lại Dashboard
    </a>
</div>

<h3 class="fw-bold text-dark mb-4">Chấm Bài & Phản Hồi</h3>

<div class="row">
    {% for sub in submissions %}
    <div class="col-md-6">
        <div class="submission-card shadow-sm">
            <div class="d-flex justify-content-between mb-2">
                <span class="fw-bold text-primary">#{{ sub.submission_id }} - {{ sub.student.user.fullname }}</span>
                <small class="text-muted">{{ sub.submitted_at.strftime('%d/%m %H:%M') }}</small>
            </div>
            
            <div class="alert alert-secondary p-2 mb-3 small" style="background: #fafafa;">
                <strong>Bài làm:</strong><br>
                {{ sub.answer }}
            </div>
            
            <form action="/teacher/grading/update" method="post">
                <input type="hidden" name="submission_id" value="{{ sub.submission_id }}">
                
                <div class="row mb-3">
                    <div class="col-6">
                        <div class="score-box">
                            <span class="d-block text-muted small">Điểm AI chấm</span>
                            <span class="fw-bold text-primary fs-5">{{ sub.ai_score }}</span>
                            <span class="ai-badge">AI BOT</span>
                        </div>
                    </div>
                    <div class="col-6">
                        <label class="small fw-bold mb-1">Điểm Chính Thức</label>
                        <input type="number" step="0.1" name="teacher_score" class="form-control fw-bold text-center" 
                               value="{{ sub.teacher_score if sub.teacher_score else sub.ai_score }}">
                    </div>
                </div>

                <div class="mb-3">
                    <label class="small fw-bold">Nhận xét của giáo viên</label>
                    <textarea name="feedback" class="form-control" rows="2" placeholder="Nhập lời phê...">{{ sub.teacher_feedback }}</textarea>
                </div>

                <button type="submit" class="btn btn-success w-100 btn-sm fw-bold">
                    <i class="fas fa-check-circle me-1"></i> Lưu Kết Quả
                </button>
            </form>
        </div>
    </div>
    {% else %}
    <div class="col-12 text-center text-muted py-5">
        <i class="fas fa-clipboard-check fa-3x mb-3 text-secondary opacity-50"></i>
        <p>Hiện tại không có bài tập nào cần chấm.</p>
    </div>
    {% endfor %}
</div>
{% endblock %}